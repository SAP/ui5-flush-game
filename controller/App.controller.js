sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../controls/MessageToastDeluxe","../model/formatter","sap/ui/test/actions/Press","sap/base/util/UriParameters","sap/ui/core/Fragment","sap/ui/thirdparty/jquery"],function(e,t,i,r,n,o,s,a){"use strict";return e.extend("flush.game.controller.App",{formatter:r,onInit:function(){e.prototype.onInit.apply(this,arguments);var i=new o(window.location.href),r=!!i.get("sap-ui-godMode");var n=new t({score:0,progress:1,multiProgress:1,mood:100,godMode:false,mode:"1player",idleTimeReloopIntro:12e4,player1:"images/player1.png",player2:"images/player2.png",flushLogo:"images/flush_logo.png",chickenOut:"images/ChickenOut.png",switchMode:"images/SwitchMode.png"});this.setModel(n,"appView");if(r){this.activateGodMode()}this.ready().then(function(){this._initArcadeControlEvents();this._initEscape();this._initEnter()}.bind(this))},_initArcadeControlEvents:function(){var e=this;n.prototype.executeOnArcade=function(t){if(!t.$().length){return}var i=this.$(t),r=i[0];if(i.length){if(e["__sneakedInTimeout"]){return}this._createAndDispatchMouseEvent("mousedown",r);e["__sneakedInTimeout"]=setTimeout(function(){this._createAndDispatchMouseEvent("mouseup",r);e["__sneakedInTimeout"]=null}.bind(this),200)}};var t=function(e){try{(new n).executeOnArcade(this.byId("app").getCurrentPage().byId("arcadeBoard--"+e))}catch(e){}}.bind(this);document.addEventListener("click",function(e){var i=e.target.getAttribute("id");if(!i&&e.target.parentNode){i=e.target.parentNode.getAttribute("id")}var r=i&&i.split("--").pop().split("-")[0];var n=["a","b","l","r","u","d"];if(n.indexOf(r)===-1){if(e.which===1){t("a")}else if(e.which===2){t("b")}}});var i=function(e){var t=this.byId("app").getCurrentPage(),i=t.getId().split("---").pop();if(i==="home"||i==="multi"){var r=a.Event("keypress");r.ctrlKey=false;var o=t.byId("levels");switch(e){case"ArrowLeft":o.onsapleft(r);break;case"ArrowRight":o.onsapright(r);break;case"ArrowUp":o.onsapup(r);break;case"ArrowDown":o.onsapdown(r);break;case"Enter":try{var o=sap.ui.getCore().byId(document.activeElement.getAttribute("id"));(new n).executeOn(o)}catch(e){}break}}}.bind(this);document.addEventListener("keydown",function(e){switch(e.key){case"ArrowLeft":case"a":t("l");i("ArrowLeft");break;case"ArrowRight":case"d":t("r");i("ArrowRight");break;case"ArrowUp":case"w":t("u");i("ArrowUp");break;case"ArrowDown":case"s":t("d");i("ArrowDown");break;case" ":t("a");i("Enter");break;case"b":t("b");break}}.bind(this))},_initEscape:function(){document.addEventListener("keyup",function(e){var t=this.byId("Escape");if(t&&t.isOpen()){if(e.key==="Escape"||e.key==="5"){t.getBeginButton().firePress()}else{t.getEndButton().firePress()}t.destroy();return}var i=this.byId("SwitchMode");if(i&&i.isOpen()){if(e.key==="Escape"||e.key==="5"||e.key==="1"||e.key==="2"||e.key==="3"){i.getBeginButton().firePress()}else{i.getEndButton().firePress()}i.destroy();return}if(e.key==="1"||e.key==="2"||e.key==="3"||e.key==="Escape"||e.key==="5"){var r=this.byId("app").getCurrentPage(),n=r.getId().split("---").pop();if(n==="intro"&&this.getModel("appView").getProperty("/score")===0){r.getController()._endIntro()}if(e.key==="1"||e.key==="2"||e.key==="3"){var o=this.getModel("appView").getProperty("/mode");if(e.key==="1"&&o==="1player"||e.key==="2"&&o==="2player"){this.getSoundManager().play("coin");return}var a=e.key==="1"?"1player":"2player";if(e.key==="3"){a=o==="1player"?"2player":"1player"}if(n==="game"){var d={formatter:this.formatter,onStay:function(){this.byId("SwitchMode").close()}.bind(this),onLeave:function(){var e=this.byId("app").getCurrentPage();if(e.getId().split("---").pop()==="game"){e.byId("page").end().then(function(){this.onSwitchMode(a)}.bind(this))}else{this.onSwitchMode(a)}this.byId("SwitchMode").close()}.bind(this)};if(!i){s.load({id:this.getView().getId(),name:"flush.game.view.SwitchMode",controller:d}).then(function(e){e.setInitialFocus(e.getBeginButton());this.getView().addDependent(e);e.open()}.bind(this))}else{i.open()}}else{this.onSwitchMode(a)}}else if(e.key==="Escape"||e.key==="5"){var d={formatter:this.formatter,onStay:function(){this.byId("Escape").close()}.bind(this),onLeave:function(){var e=this.byId("app").getCurrentPage();if(e.getId().split("---").pop()==="game"){e.byId("page").end().then(function(){this.reset()}.bind(this))}else{this.reset()}this.byId("Escape").close()}.bind(this)};if(!t){s.load({id:this.getView().getId(),name:"flush.game.view.Escape",controller:d}).then(function(e){e.setInitialFocus(e.getBeginButton());this.getView().addDependent(e);e.open()}.bind(this))}else{t.open()}}}}.bind(this))},_initEnter:function(){var e=function(e){try{(new n).executeOn(e)}catch(e){}}.bind(this);document.addEventListener("keyup",function(t){switch(t.key){case"g":case"h":var i=sap.ui.getCore().byId(document.activeElement.getAttribute("id"));if(i&&i.getMetadata().getName()!=="flush.game.controls.Game"){e(i)}break}})},reset:function(){var e=this.getModel("appView");e.setProperty("/score",0);e.setProperty("/progress",1);e.setProperty("/multiProgress",1);e.setProperty("/mood",100);e.setProperty("/godMode",false);this.getSoundManager().play("Loose");var t=this.byId("app").getCurrentPage(),i=t.getId().split("---").pop();if(i==="intro"){t.getController()._endIntro()}if(this.getModel("appView").getProperty("/mode")==="2player"||i==="multi"||i==="game"&&t.getModel("view").getProperty("/multi")){this.getRouter().navTo("multi");if(i==="multi"){this.getRouter().getRoute("multi").fireEvent("patternMatched")}}else{this.getRouter().navTo("home");if(i==="home"){this.getRouter().getRoute("home").fireEvent("patternMatched")}}},activateGodMode:function(){var e=new i({message:"God mode activated",image:"GodMode.png",duration:5e3,position:"center bottom"});this.ready().then(function(){e.show().then(function(){e.destroy()});this.getBadWeather().stop();this.getSoundManager().stop("thunderLightning");this.getSoundManager().play("Win");var t=this.byId("app").getCurrentPage();if(t.getId().split("---").pop()==="home"){t.getController()._unlockLevels()}}.bind(this));this.getModel("appView").setProperty("/godMode",true);this.getModel("appView").setProperty("/score",9999);this.getModel("appView").setProperty("/mood",3)}})});