sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/base/util/UriParameters"],function(e,t,r,i){"use strict";return e.extend("flush.game.controller.Game",{formatter:r,onInit:function(){e.prototype.onInit.apply(this,arguments);var r=new t({level:"",multi:false,instructions:"",difficulty:1,title:this.getResourceBundle().getText("gameTitleLoading"),busy:true,player1Energy:0,player2Energy:0,player1Lives:0,player2Lives:0,player1LivesArray:[],player2LivesArray:[]});this.setModel(r,"view");this.getRouter().getRoute("game").attachPatternMatched(this._setLevelSettings,this)},_setLevelSettings:function(e){var t=e.getParameter("arguments");var r=this.getModel("view");r.setProperty("/busy",true);r.setProperty("/level",t.level,null,true);r.setProperty("/difficulty",parseInt(t.difficulty),null,true);r.setProperty("/multi",/multi/i.test(t.level),null,true);r.setProperty("/instructions",this.getResourceBundle().getText("gameInstructions"+t.level),null,true);if(t.level==="WhackABug"){r.setProperty("/timeLimit",45,null,true)}else if(t.level==="Uncontrollable"){r.setProperty("/timeLimit",60,null,true)}else if(t.level==="UncontrollableMultiplayer"){r.setProperty("/timeLimit",60,null,true)}else if(t.level==="PlopARobot"){r.setProperty("/timeLimit",30,null,true)}var l=new i(window.location.href);if(l.get("game-debug")){r.setProperty("/timeLimit",999999,null,true);r.setProperty("/debug",true,null,true)}r.setProperty("/title",this.getResourceBundle().getText("gameTitleLevel",[t.level,t.difficulty]),null,true);this.byId("page").invalidate();this._playStory(t.level);this.getSoundManager().stop("Level");this.getSoundManager().play("Level");r.refresh(true)},_updateLifeBar:function(e){var t=this.getModel("view").getProperty("/player"+e+"Lives");var r=[];for(var i=0;i<t;i++){r.push(1)}this.getModel("view").setProperty("/player"+e+"LivesArray",r)},onLevelInit:function(){this.getModel("view").setProperty("/busy",false);this._updateLifeBar(1);this._updateLifeBar(2);this.getSoundManager().play("roboStart")},onLevelEnd:function(e){clearInterval(this._iInterval);this.getModel("appView").setProperty("/fromGame",true);this.getModel("view").setProperty("/instructions","");if(this.getModel("view").getProperty("/multi")){this.getRouter().getTargets().display("multi",{who:e.getParameter("who"),level:this.getModel("view").getProperty("/level"),difficulty:this.getModel("view").getProperty("/difficulty")});this.getRouter().navTo("multi",undefined,true)}else{this.getRouter().navTo("home")}},onLevelHit:function(e){var t=e.getParameter("who");this._updateLifeBar(t)},onLevelBomb:function(e){var t=e.getParameter("who")},onBack:function(){clearInterval(this._iInterval);this._stopStory();this.getModel("appView").setProperty("/fromGame",true);this.getModel("view").setProperty("/instructions","");this.byId("page").end().then(function(){if(this.getModel("view").getProperty("/multi")){this.getRouter().navTo("multi")}else{this.getRouter().navTo("home")}}.bind(this))}})});