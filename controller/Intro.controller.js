sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","sap/m/MessageBox","../model/formatter"],function(t,e,i,n){"use strict";return t.extend("flush.game.controller.Intro",{formatter:n,onInit:function(){t.prototype.onInit.apply(this,arguments);this._bIntroPlaying=false;var i=new e({score:0,progress:1,godMode:false,intro:[{file:"images/Intro0LogoBg.png"},{file:"images/Intro1Scherbenhaufen.png"},{file:"images/Intro2Blitzschlag.png"},{file:"images/Intro3VerkohlterRM.png"},{file:"images/Intro4RMVerrueckt.png"},{file:"images/Intro5DerHeldmussran.png"}]});this.setModel(i,"view");this.getRouter().getRoute("intro").attachPatternMatched(this._playIntro,this);this.ready().then(function(){try{this.getBadWeather().rain()}catch(t){}}.bind(this))},onCarouselChange:function(t){var e=t.getParameter("newActivePageId");var i=t.getParameter("oldActivePageId");if(this._bCarouselStoryTriggeredChange){this._bCarouselStoryTriggeredChange=false;return}this._bIntroPlaying=false;if(e!==i){var n=parseInt(e.split("-").pop());var r=this._playChapter(n);if(n===5){r.then(function(){this._endIntro()}.bind(this))}}},_flushErrorDialog:function(){i.error("DirtyFlushException",{id:"DirtyFlushException",title:"DirtyFlushException: An error occurred while flushing UI5 controls",details:"@Core.js:1337",actions:[i.Action.CLOSE]});setTimeout(function(){var t=sap.ui.getCore().byId("DirtyFlushException");if(t){t.destroy()}},3e3)},_animateMood:function(){setTimeout(function(){if(!this._bAnimateMood){return}var t=Math.floor(Math.abs(Math.random())*100);this.getModel("appView").setProperty("/mood",t);this._animateMood()}.bind(this),500)},_showIntroBackground(t){var e=this.byId("introBg");e.setActivePage(e.getPages()[t])},_playChapter:function(t){if(!this.byId("page")){return{then:function(){}}}this._stopStory();this._showIntroBackground(t);switch(t){case 0:this.getSoundManager().play("thunderLightning");this.getSoundManager().play("coin",5e3);break;case 1:this.getBadWeather().rain("heavy");this.getBadWeather().lightning();break;case 2:this.getSoundManager().play("thunderHit",0,5e3);this.getModel("appView").setProperty("/mood",50);break;case 3:this.getModel("appView").setProperty("/mood",80);this.getSoundManager().play("growl");setTimeout(function(){this._bAnimateMood=true;this._animateMood()}.bind(this),1500);setTimeout(function(){this._flushErrorDialog()}.bind(this),3e3);break;case 4:this.getSoundManager().play("thunderLightning");this.getSoundManager().play("devil");this.getBadWeather().rain("moderate");break;case 5:this._bAnimateMood=false;this.getModel("appView").setProperty("/mood",100);break}return this._playStory("intro"+t)},_playIntro:function(){var t=window.AudioContext||window.webkitAudioContext||false;if(t&&(new t).state==="suspended"){this.getModel("view").setProperty("/instructions","Please click anywhere to enable the intro sound");document.addEventListener("click",function(){this.getSoundManager().play("thunderLightning");this.getModel("view").setProperty("/instructions","Thanks, enjoy the game!")}.bind(this))}this._bAnimateMood=false;this._bCarouselStoryTriggeredChange=true;this._bIntroPlaying=true;this.byId("introBg").invalidate();this.getModel("appView").setProperty("/mood",1);this.ready().then(function(){this._bCarouselStoryTriggeredChange=true;this._playChapter(0).then(function(){if(!this._bIntroPlaying){return}this._bCarouselStoryTriggeredChange=true;this._playChapter(1).then(function(){if(!this._bIntroPlaying){return}this._bCarouselStoryTriggeredChange=true;this._playChapter(2).then(function(){if(!this._bIntroPlaying){return}this._bCarouselStoryTriggeredChange=true;this._playChapter(3).then(function(){if(!this._bIntroPlaying){return}this._bCarouselStoryTriggeredChange=true;this._playChapter(4).then(function(){if(!this._bIntroPlaying){return}this._bCarouselStoryTriggeredChange=true;this._playChapter(5).then(function(){if(!this._bIntroPlaying){return}this._endIntro()}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))}.bind(this))},_endIntro:function(){this._bAnimateMood=false;this._bIntroPlaying=false;this.getModel("appView").setProperty("/mood",100);this.getSoundManager().stopAllSounds();this.getRouter().navTo("home")},onSkip:function(){this._stopStory();this._endIntro()}})});